/*
 * @author      OA Wu <comdan66@gmail.com>
 * @copyright   Copyright (c) 2015 - 2019, Ginkgo
 * @license     http://opensource.org/licenses/MIT  MIT License
 * @link        https://www.ioa.tw/
 */

$(function(){function s(t){return $("<"+t+" />")}function o(){return s("div")}function r(){return s("label")}function l(){return s("i")}function a(){this.controller=null,this.load=function(){return null},this.setController=function(t){if(!(t instanceof f))throw new Error("controller 格式錯誤！");this.controller=t}}function h(t,i,n,e,s){a.call(this),this.setSection=function(t){if(!(t instanceof c))throw new Error("section 格式錯誤！");return this.section=t,this},this.load=function(){var t=r();return null!==this.switchVal?t.attr("id",this.option.id).attr("class",this.option.class).addClass(this.switchVal?"a":"b").attr("data-subtitle",this.subtitle).text(this.title).append(l().click(function(){t.attr("class",t.hasClass("a")?"b":"a"),this.event&&this.event.bind(this.section.tableView.controller.navigation,!!t.hasClass("a"))()}.bind(this))):t.attr("id",this.option.id).attr("class",this.option.class).attr("data-subtitle",this.subtitle).text(this.title).append(l()).click(this.event&&this.event.bind(this.section.tableView.controller.navigation))},"function"==typeof i&&(s=e,e=n,n=i,i=null),"boolean"==typeof i&&(s=e,e=i,i=null),this.section=null,this.title="string"==typeof t?t:"",this.subtitle="string"==typeof i?i:null,this.event="function"==typeof n?n:null,this.switchVal=null!==e&&"boolean"==typeof e?e:null,this.option=$.extend({id:null,class:null},s)}var e=$("body");h.prototype=Object.create(a.prototype);var c=function(t,i,n){a.call(this),this.setTableView=function(t){if(!(t instanceof u))throw new Error("tableView 格式錯誤！");return this.tableView=t,this},this.load=function(){return o().attr("id",this.option.id).attr("class",this.option.class).attr("data-title",this.title).attr("id",this.option.id).append(this.cells.map(function(t){return t.load()}))},$.isArray(t)&&(n=i,i=t,t=null),this.tableView=null,this.title="string"==typeof t?t:null,this.cells=$.isArray(i)?i.filter(function(t){return t instanceof h}).map(function(t){return t.setSection(this)}.bind(this)):[],this.option=$.extend({id:null,class:null},n)};c.prototype=Object.create(a.prototype);var u=function(t,i){a.call(this),this.load=function(){return o().attr("id",this.option.id).attr("class",this.option.class).append(this.sections.map(function(t){return t.load()}))},this.sections=$.isArray(t)?t.filter(function(t){return t instanceof c}).map(function(t){return t.setTableView(this)}.bind(this)):[],this.option=$.extend({id:null,class:null},i)};u.prototype=Object.create(a.prototype);var f=function(t){this.title=null,this.left=null,this.right=null,this.view=null,this.navigation=null,this.setNavigation=function(t){if(!(t instanceof n))throw new Error("navigation 格式錯誤！");return this.navigation=t,this},this.setTitle=function(t,i){if("string"!=typeof t)throw new Error("text 格式錯誤！");if(void 0!==i&&"function"!=typeof i)throw new Error("click 格式錯誤！");return this.title={text:t,click:i},this},this.setLeft=function(t,i){if("string"!=typeof t)throw new Error("text 格式錯誤！");if(void 0!==i&&"function"!=typeof i)throw new Error("click 格式錯誤！");return this.left={text:t,click:i},this},this.setRight=function(t,i){if("string"!=typeof t)throw new Error("text 格式錯誤！");if(void 0!==i&&"function"!=typeof i)throw new Error("click 格式錯誤！");return this.right={text:t,click:i},this},this.setView=function(t){if(!(t instanceof a))throw new Error("View 格式錯誤！");return t.setController(this),this.view=t,this},this.load=function(){var t=this.view?this.view.load():"";t=o().append("string"==typeof t||t instanceof jQuery?t:"");var i=this.title&&s("b").text(this.title.text).click(this.title.click?this.title.click.bind(this.navigation):null),n=this.left&&r().text(this.left.text).click(this.left.click?this.left.click.bind(this.navigation):null),e=this.right&&r().text(this.right.text).click(this.right.click?this.right.click.bind(this.navigation):null);return o().append(s("header").append(n).append(i).append(e)).append(t)},"string"==typeof t&&this.setTitle(t)},n=function(t,i){if(void 0===t)throw new Error("沒有 Root ViewController！");function n(){this.E=this.V=null,this.Vs=[]}this.present=function(t,i){return i=void 0===i||i,t="function"==typeof t?t.bind(this):null,this.E.appendTo(e),i?setTimeout(function(){this.E.addClass("a"),t&&t()}.bind(this),100):(this.E.addClass("a"),t&&t()),this},this.push=function(t,i,n){if(!(t instanceof f))throw new Error("ViewController 格式錯誤！");n=void 0===n||n,i="function"==typeof i?i.bind(this):null,this.Vs.length&&null===t.left&&t.setLeft("返回",this.pop.bind(this,!0)),t.setNavigation(this),t=t.load(),this.V.append(t),n?setTimeout(function(){t.addClass("a"),i&&i()}.bind(this),100):(t.addClass("a"),i&&i()),this.Vs.push(t)},this.pop=function(t,i){i=void 0===i||i,t="function"==typeof t?t.bind(this):null;var n=this.Vs.pop();if(n)return n.removeClass("a"),i?setTimeout(function(){n.remove(),t&&t()}.bind(this),300):(n.remove(),t&&t()),this},this.dismiss=function(t,i){i=void 0===i||i,t="function"==typeof t?t.bind(this):null,this.E.removeClass("a"),i?setTimeout(function(){this.E.remove(),n(),t&&t()}.bind(this),300):(this.E.remove(),n(),t&&t())},n(),i=$.extend({id:null,class:null,showClass:"show"},i),this.E=o().attr("id",i.id).attr("class",i.class).append(r()),this.V=o(),this.Vs=[],this.E.append(this.V),this.push(t,null,!1)};h.create=function(t,i,n,e,s){return new h(t,i,n,e,s)},c.create=function(t,i,n){return new c(t,i,n)},u.create=function(t,i){return new u(t,i)},f.create=function(t){return new f(t)},n.create=function(t,i){return new n(t,i)};var t=[c.create("aaa",[h.create("交通路況"),h.create("交通路況","顯示時間"),h.create("交通路況",function(){this.dismiss()}),h.create("交通路況",function(){console.error(this),this.dismiss()},!0),h.create("交通路況","顯示時間",function(){this.push(f.create("啦啦啦"))}),h.create("交通路況",function(){},!0),h.create("交通路況","顯示時間",function(){},!0),h.create("交通路況",function(){},!1),h.create("交通路況","顯示時間",function(){},!1)])],i=u.create(t,{class:"x0"}),d=f.create("asd").setLeft("新增",function(){this.push(f.create("啦啦啦"))}).setRight("關閉",function(){this.dismiss(function(){console.error(this)})}).setView(i);n.create(d,{id:"x",showClass:"a"}).present(function(){})});