/*
 * @author      OA Wu <comdan66@gmail.com>
 * @copyright   Copyright (c) 2015 - 2019, Ginkgo
 * @license     http://opensource.org/licenses/MIT  MIT License
 * @link        https://www.ioa.tw/
 */

function L(t){if(!(this instanceof L))return new L(t);this._div=null,this._option=Object.assign({className:"",top:0,left:0,width:32,height:32,html:"",map:null,position:null,css:{}},t),this._option.map&&this.setMap(this._option.map)}function i(){L.prototype=new google.maps.OverlayView,Object.assign(L.prototype,{setPoint:function(){if(this._div){if(!this._option.position)return this._div.style.left="-999px",void(this._div.style.top="-999px");if(this.getProjection()){var t=this.getProjection().fromLatLngToDivPixel(this._option.position);t&&(this._div.style.left=t.x-this._option.width/2+this._option.left+"px",this._div.style.top=t.y-this._option.height/2+this._option.top+"px")}}},draw:function(){this.setPoint()},onAdd:function(){for(var t in this._div=document.createElement("div"),this._div.style.position="absolute",this._div.className=this._option.className,this._div.style.width=this._option.width+"px",this._div.style.height=this._option.height+"px",this._div.innerHTML=this._option.html,this._option.css)"width"!=t&&"height"!=t&&"top"!=t&&"left"!=t&&"bottom"!=t&&"right"!=t&&(this._div.style[t]=this._option.css[t]);var i=this;google.maps.event.addDomListener(this._div,"click",function(t){t.stopPropagation&&t.stopPropagation(),google.maps.event.trigger(i,"click")}),this.getPanes().overlayImage.appendChild(this._div)},remove:function(){return this._div&&(this._div.parentNode.removeChild(this._div),this._div=null),this},setHtml:function(t){return this._option.html=t,this._div&&(this._div.innerHTML=this._option.html),this},getClassName:function(){return this._option.className},setClassName:function(t){return this._option.className=t,this._div&&(this._div.className=this._option.className),this},setPosition:function(t){return this.map&&(this._option.position=t,this.setPoint()),this},getPosition:function(){return this._option.position}})}function C(){if(!(this instanceof C))return new C;if("object"!=typeof C.keys||!Array.isArray(C.keys))return!1;if(!0===C.inited)return C.inited;C.inited=!0,window.gmc=function(){$(window).trigger("gm")},$(window).bind("gm",C.callback),C.callback=function(){if(!0!==C.callbacked)return C.callbacked=!0,i(),"function"==typeof C.finish&&C.finish()};var t=C.keys[Math.floor(Math.random()*C.keys.length)];return $.getScript("https://maps.googleapis.com/maps/api/js?"+(t?"key="+t+"&":"")+"language=zh-TW&libraries=visualization&callback=gmc",C.callback),!0}$(function(){function l(t,i,e,n){if(!(this instanceof l))return n?new l(t,i,e).toHTML():new l(t,i,e).toString();t&&"string"==typeof t||(e=i,i=t,t="component"),i=Array.isArray(i)?i.map(function(t){var i=(t=[t.substr(0,t.indexOf("=")),t.substr(t.indexOf("=")+1)].map(function(t){return t.trim()}).filter(function(t){return t.length})).slice(0,1).join("="),e=t.slice(1).join("=");return i&&e?(i="@"==(i="@click"==(i="@focus"==(i="@model"==(i="@text"==(i="@html"==(i="@bind"==(i="@on"==(i="@for"==(i="@if"==i?"v-if":i)?"v-for":i)?"v-on":i)?"v-bind":i)?"v-html":i)?"v-text":i)?"v-model.trim":i)?"v-on:focus":i)?"v-on:click":i)[0]?":"+i.substr(1):i)+'="'+e.replace(/"/g,"'")+'"':null}).filter(function(t){return t}).join(" "):"",e="string"==typeof(e=Array.isArray(e)?e.join(""):e)?e:"",this.toString=function(){return-1!="area,base,br,col,command,embed,hr,img,input,keygen,link,meta,param,source,track,wbr".split(/,/).indexOf(t)?"<"+t+(i&&" "+i)+" />":"<"+t+(i&&" "+i)+">"+e+"</"+t+">"},this.toHTML=function(){var t=document.createElement("template");return t.innerHTML=this,t=t.content.firstChild,document.body.appendChild(t),t}}var T=Vue.component.bind(Vue);function n(){if(!(this instanceof n))return new n;var s=new Vue({comments:!1,data:{display:!1,show:!1,viewControllers:[]},methods:{nowVC:function(){return 0<this.vcs.length?this.vcs[this.vcs.length-1]:null}},computed:{vcs:function(){return this.viewControllers.filter(function(t){return t instanceof o})}},el:l("div",["@if=display",'@class=["Win", { show: show }]'],l(["@for=(vc, i) in vcs","@key=i","@is=vc.component","@controller=vc"]),!0)});this.present=function(t,i,e){if(!(t instanceof o))return this;var n=function(){s.show||(s.show=!0),s.viewControllers.push(t),n=setTimeout(function(){t.addClass("present"),"function"==typeof i&&setTimeout(i.bind(t),300)},100),n=null,delete n};return!1!==e?(s.display||(s.display=!0))&&s.show?n():setTimeout(n.bind(null),100):(s.display||(s.display=!0))&&(s.show||(s.show=!0))&&s.viewControllers.push(t.addClass("present"))&&"function"==typeof i&&i.call(t),this},this.dismiss=function(t,i,e){return t instanceof o&&t===s.nowVC()&&(!1===e?s.viewControllers.pop().removeClass("present")&&s.vcs.length?"function"!=typeof i||i.call(t):(s.show=!1)||(s.display=!1)||"function"!=typeof i||i.call(t):t.removeClass("present")&&setTimeout(function(){s.viewControllers.pop(),s.vcs.length?"function"!=typeof i||i.call(t):!(s.show=!1)&&setTimeout(function(){s.display=!1},300)&&"function"==typeof i&&setTimeout(i.bind(t),10)},300)),this}}function i(t){if(!(this instanceof i))return new i(t);this.on={},this.class="string"==typeof t?t:null,this.classList=function(){return this.class.split(/\s+/)},this.hasClass=function(i){return 0!=this.classList().filter(function(t){return t===i}).length},this.addClass=function(t){if("string"!=typeof t||!(t=t.trim()))return this;if(this.hasClass(t))return this;var i=this.classList();return i.push(t),this.class=i.join(" "),this},this.removeClass=function(i){return"string"==typeof i&&(i=i.trim())&&this.hasClass(i)&&(this.class=this.classList().filter(function(t){return t!=i}).join(" ")),this}}function A(t){if(!(this instanceof A))return new A(t);i.call(this,"V"),this.controller=null,this.component=T("v"),this.text=null,this.el="string"==typeof t&&t.length?t:"div",this.present=function(t,i){return this.controller?this.controller.present(t,i):this},this.dismiss=function(t,i){return this.controller?this.controller.dismiss(t,i):this},this.push=function(t,i){return this.controller?this.controller.push(t,i):this},this.pop=function(t,i){return this.controller?this.controller.pop(t,i):this}}function o(){if(!(this instanceof o))return new o;i.call(this,"VC"),this.component=T("vc"),this.navigationController=null,this.navigationBar=null,this.view=A(),this.present=function(t,i){return n.main().present(this.navigationController?this.navigationController:this,t,i)&&this},this.dismiss=function(t,i){return n.main().dismiss(this.navigationController?this.navigationController:this,t,i)&&this},this.push=function(t,i,e){return this.navigationController&&this.navigationController.push(t,i,e),this},this.pop=function(t,i){return this.navigationController&&this.navigationController.pop(t,i),this},this.setLeft=function(t,i,e){return this.navigationBar||(this.navigationBar=r()),this.navigationBar.left||(this.navigationBar.left=s("label")),this.navigationBar.left.text=t,this.navigationBar.left.class=e,this.navigationBar.left.on.click=i,this},this.setTitle=function(t,i,e){return this.navigationBar||(this.navigationBar=r()),this.navigationBar.title||(this.navigationBar.title=s("header")),this.navigationBar.title.text=t,this.navigationBar.title.class=e,this.navigationBar.title.on.click=i,this},this.setRight=function(t,i,e){return this.navigationBar||(this.navigationBar=r()),this.navigationBar.right||(this.navigationBar.right=s("label")),this.navigationBar.right.text=t,this.navigationBar.right.class=e,this.navigationBar.right.on.click=i,this}}function s(t){if(!(this instanceof s))return new s(t);A.call(this,t),this.navigationBar=null,this.navigationController=null,this.class=null}function r(){if(!(this instanceof r))return new r;A.call(this),this.navigationController=null,this.component=T("nav-bar"),this.class="NB",this.left=null,this.title=null,this.right=null}function a(t){if(!(this instanceof a))return new a(t);o.call(this);var s=!1;this.component=T("nc"),this.viewControllers=[],this.viewController=null,this.lastViewController=function(){return 1<this.viewControllers.length?this.viewControllers[this.viewControllers.length-2]:null},this.thisViewController=function(){return 0<this.viewControllers.length?this.viewControllers[this.viewControllers.length-1]:null},this.push=function(t,i,e){if(s)return this;if(!(t instanceof o)||t instanceof a||t instanceof h)return this;s=!0,t.navigationBar||(t.navigationBar=r());var n=this.thisViewController();return n&&t.setLeft("返回",this.pop.bind(this),"back"),this.viewController=t,!1===e?!this.viewControllers.push(t)||!t.addClass("push").addClass("ed")||n&&!n.addClass("ed").addClass("last")||(s=!1)||"function"!=typeof i||i.call(this):!this.viewControllers.push(t.addClass("ani"))||n&&!n.addClass("ani")||setTimeout(function(){t.addClass("push"),n&&n.addClass("last"),setTimeout(function(){t.addClass("ed"),s=!1,"function"==typeof i&&i.call(this)}.bind(this),400)}.bind(this),100),this},this.pop=function(t,i){if(s)return this;var e=this.thisViewController(),n=this.lastViewController();return null===n?this.dismiss(t,i):(!(s=!0)===i?this.viewControllers.pop().removeClass("ani").removeClass("ed").removeClass("push")&&n.removeClass("ani").removeClass("last").removeClass("ed")&&!(s=!1)&&"function"==typeof t&&t.call(this):e.addClass("ani").removeClass("ed").removeClass("push")&&n.addClass("ani").removeClass("last")&&setTimeout(function(){this.viewControllers.pop(),s=!1,"function"==typeof t&&t.call(this)}.bind(this),400),this)},this.addClass("NC").push(t,null,!1)}function h(t,i,e){if(!(this instanceof h))return new h(t,i,e);o.call(this),this.view.component=T("acv"),this.view.buttons=[],this.view.title=null,this.view.message=null,this.setTitle=function(t){return"string"==typeof t&&t&&(this.view.title=t),this},this.setMessage=function(t){return"string"==typeof t&&t&&(this.view.message=t),this},this.setStyle=function(t){return"string"==typeof t&&("sheet"==t?this.addClass("sheet"):this.removeClass("sheet")),this},this.appendButton=function(t,i){if("string"==typeof t&&t){var e=A("label");e.class=null,e.text=t,e.on.click=i,this.view.buttons.push(e)}return this},this.present=function(t,i){return n.main().present(this,function(){this.view.addClass("popup"),"function"==typeof t&&(!1===i?t.call(this):setTimeout(t.bind(this),300))},i)&&this},this.dismiss=function(t,i){return this.view.removeClass("popup"),!1===i?n.main().dismiss(this,t,i):setTimeout(n.main().dismiss.bind(n.main(),this,t,i),300),this},this.addClass("AC").setTitle(t).setMessage(i).setStyle(e)}function u(t,i,e,n,s,l,o){if(!(this instanceof u))return new u(t,i,e,n,s,l,o);A.call(this),this.section=null,this.tableView=null,this.component=T("tv-cl"),this.image=null,this.title=null,this.detail=null,this.name=null,this.value=null,this.check=null,this.color=null,this.align=null,this.wrap=null,this.layout=null,this.marker=null,this.error=null,this.isOn=!1,this.click=null,this.checkCanOff=!1;var r=["arrow","check","switch","input","text"],a=["subtitle","value"],h=["blue","red"],c=["left","center","right"];this.setImage=function(t){return"string"==typeof t&&t&&(this.image={type:"img",val:t}),null===t&&(this.image=null),this},this.setIcon=function(t){return"string"==typeof t&&t&&(this.image={type:"icon",val:t}),null===t&&(this.image=null),this},this.setTitle=function(t){return"string"==typeof t&&t&&(this.title=t),null===t&&(this.title=null),this},this.setName=function(t){return"string"==typeof t&&t&&(this.name=t),null===t&&(this.name=null),this},this.setValue=function(t){return"string"==typeof t&&t&&(this.value=t),null===t&&(this.value=null),this},this.setWrap=function(t){return"boolean"==typeof t&&(this.wrap=t?"wrap":null),null===t&&(this.wrap=null),this},this.setDetail=function(t){return"string"==typeof t&&t&&(this.detail=t)&&null===this.layout&&this.setLayout("subtitle"),null===t&&(this.detail=null),this},this.setAlign=function(t){return"string"==typeof t&&-1!==c.indexOf(t)&&(this.align=t),null===t&&(this.align=null),this},this.setColor=function(t){return"string"==typeof t&&-1!==h.indexOf(t)&&(this.color=t),null===t&&(this.color=null),this},this.setLayout=function(t){return"string"==typeof t&&-1!==a.indexOf(t)&&(this.layout=t),null===t&&(this.layout=null),this},this.setMarker=function(t){return"string"==typeof t&&-1!==r.indexOf(t)&&(this.marker=t),null===t&&(this.marker=null),this},this.setCheck=function(t){return"function"==typeof t&&t&&(this.check=t),null===t&&(this.check=null),this},this.setClick=function(t){return"function"==typeof t&&t&&(this.click=t),null===t&&(this.click=null),this},this.setOn=function(t){return this.isOn=!("boolean"!=typeof t||!t),this},this.setCanOff=function(t){return this.checkCanOff=!("boolean"!=typeof t||!t),this},this.setTitle(t).setDetail(i).setMarker(e).setClick(n).setLayout(s).setName(l).setValue(o).class="TVCL"}function e(){if(!(this instanceof e))return new e;A.call(this),this.section=null,this.tableView=null,this.component=T("tv-h"),this.html=null,this.class=null,this.el="header"}function c(){if(!(this instanceof c))return new c;A.call(this),this.section=null,this.tableView=null,this.component=T("tv-f"),this.html=null,this.class=null,this.el="footer"}function f(t){if(!(this instanceof f))return new f(t);A.call(this),this.tableView=null,this.component=T("tv-s"),this.header=null,this.footer=null,this.rows=[],this.resetRows=function(t){return this.rows=[],this.appendRow(t)},this.appendRow=function(t){for(var i in Array.isArray(t)||(t=[t]),t=t.filter(function(t){return t instanceof u}))this.rows.push(t[i]);return this},this.setHeader=function(t){return"string"==typeof t&&t&&(this.header||(this.header=e())&&(this.header.html=t)),this},this.setFooter=function(t){return"string"==typeof t&&t&&(this.footer||(this.footer=c())&&(this.footer.html=t)),this},this.resetRows(t).class="TVS"}function p(t){if(!(this instanceof p))return new p(t);A.call(this),this.component=T("tv"),this.sections=null,this.resetSections=function(t){return this.sections=null,this.appendSection(t)},this.appendSection=function(t){if(void 0===t)return this;for(var i in null===this.sections&&(this.sections=[]),Array.isArray(t)||(t=[t]),t=t.filter(function(t){return t instanceof f}))this.sections.push(t[i]);return this},this.rows=function(){return this.sections.filter(function(t){return t instanceof f}).map(function(t){return t.rows.filter(function(t){return t instanceof u})}).reduce(function(t,i){return t.concat(i)})},this.checkCellOnly=function(i){return i.checkCanOff?i.setOn(!i.isOn):i.setOn(!0),null!==i.name&&this.rows().filter(function(t){return"check"==t.marker&&t!=i&&t.name==i.name}).forEach(function(t){t.setOn(!1)}),"function"==typeof i.click&&i.click.call(i,i.isOn)},this.checkAll=function(){return 0==this.rows().filter(function(t){return"function"==typeof t.check}).filter(function(t){var i=t.check();return"string"==typeof i&&i&&(t.error=i)}).length},this.data=function(){if(!this.checkAll())return null;var t=this.rows().filter(function(t){return null!==t.name&&("check"!=t.marker&&"switch"!=t.marker||t.isOn)}),i={};for(var e in t)i[t[e].name]=t[e].value;return i},this.resetSections(t).addClass("TV")}function m(t){if(!(this instanceof m))return new m(t);o.call(this),this.tableView=this.view=p(t)}function g(t){if(!(this instanceof g))return new g(t);p.call(this),this.setSections=function(t){this.resetSections(t.map(function(t){var i="string"==typeof t.header&&t.header?t.header:null,e="string"==typeof t.footer&&t.footer?t.footer:null,n="object"==typeof t.rows&&Array.isArray(t.rows)?t.rows.map(function(t){if("object"!=typeof t)return null;if("string"!=typeof t.system||-1==["web","both"].indexOf(t.system))return null;var i=u();switch("string"==typeof t.title&&t.title&&i.setTitle(t.title),"string"==typeof t.detail&&t.detail&&i.setDetail(t.detail),"string"==typeof t.icon&&t.icon&&i.setIcon(t.icon),"string"==typeof t.image&&t.image&&i.setImage(t.image),"string"==typeof t.action.type?t.action.type:null){case"native":switch("string"==typeof t.action.key?t.action.key:null){case"traffic":case"pathInfo":case"pathLine":case"pathTime":case"heatmap":i.setMarker("switch");break;case"direction":case"score":i.setMarker("arrow")}break;case"article":i.setMarker("arrow").setClick("string"==typeof t.action.url&&t.action.url?function(){this.push(b().setTitle("string"==typeof t.title&&t.title?t.title:null),function(){this.thisViewController().url(t.action.url)})}:null);break;case"tableView":i.setMarker("arrow").setClick("string"==typeof t.action.url&&t.action.url?function(){this.push(v().setTitle("string"==typeof t.title&&t.title?t.title:null),function(){this.thisViewController().url(t.action.url)})}:null);break;case"historyMap":i.setMarker("arrow").setClick("string"==typeof t.action.url&&t.action.url?function(){this.push(k().setTitle("string"==typeof t.title&&t.title?t.title:null),function(){this.thisViewController().url(t.action.url)})}:null);break;case"url":case"fb":i.setMarker("arrow").setClick("string"==typeof t.action.url&&t.action.url?function(){window.open(t.action.url)}:null)}return i}).filter(function(t){return null!==t}):[];return n.length?f(n).setHeader(i).setFooter(e):null}).filter(function(t){return null!==t}))},this.setFormat=function(t){return"object"==typeof t&&t&&"object"==typeof t.sections&&Array.isArray(t.sections)&&this.setSections(t.sections),this},this.url=function(t){return $.get(t).done(this.setFormat.bind(this)).fail(this.setFormat.bind(this,{sections:[]})),this},this.addClass("Vl").url(t)}function v(t){if(!(this instanceof v))return new v(t);m.call(this),this.tableView=this.view=g(t),this.url=this.tableView.url.bind(this.tableView)}function d(t){if(!(this instanceof d))return new d(t);A.call(this,"article"),this.component=T("atv"),this.isLoaded=!1,this.timeAt=null,this.sections=[],this.references=[],this.setTimeAt=function(t){return void 0===t||(this.isLoaded=!0,"string"==typeof t&&t&&(this.timeAt=t)),this},this.setSections=function(t){return void 0===t||(this.isLoaded=!0,"object"==typeof t&&Array.isArray(t)&&(this.sections=t.map(function(t){if("object"!=typeof t)return null;var i="string"==typeof t.title&&t.title?t.title:null,e="object"==typeof t.tokens&&Array.isArray(t.tokens)?t.tokens.map(function(t){var i="string"==typeof t.type&&t.type&&-1!==["text","image"].indexOf(t.type)?t.type:null,e="string"==typeof t.val&&t.val?t.val:null,n="string"==typeof t.url&&t.url?t.url:null;return null===t.type?null:"image"==t.type&&null===n?null:"text"==t.type&&null===e?null:{type:i,val:e,url:n}}).filter(function(t){return null!==t}):[];return t.title||t.tokens.length?{tokens:e,title:i}:null}).filter(function(t){return null!==t}))),this},this.setReferences=function(t){return void 0===t||(this.isLoaded=!0,"object"==typeof t&&Array.isArray(t)&&(this.references=t.map(function(t){if("object"!=typeof t)return null;var i="string"==typeof t.title&&t.title?t.title:null,e="string"==typeof t.link&&t.link?t.link:null;return i||e?{title:i,link:e}:null}).filter(function(t){return null!==t}))),this},this.addClass("ATV")}function y(){if(!(this instanceof y))return new y;o.call(this),this.articleView=this.view=d()}function w(t){if(!(this instanceof w))return new w(t);d.call(this),this.setFormat=function(t){return"object"==typeof t&&t&&("string"==typeof t.timeAt&&t.timeAt&&this.setTimeAt(t.timeAt),"object"==typeof t.sections&&Array.isArray(t.sections)&&this.setSections(t.sections),"object"==typeof t.references&&Array.isArray(t.references)&&this.setReferences(t.references)),this},this.url=function(t){return $.get(t).done(this.setFormat.bind(this)).fail(function(){this.isLoaded=!0}.bind(this)),this},this.addClass("Vl").url(t)}function b(t){if(!(this instanceof b))return new b(t);y.call(this),this.articleView=this.view=w(t),this.url=this.articleView.url.bind(this.articleView)}function j(i,e,n,s){if(!(this instanceof j))return new j(i,e,n,s);A.call(this),this.component=T("hmv"),this.lat=null,this.lng=null,this.zoom=null,this.mapEl=null,this.gmap=null,this.title=null,this.lengths=[],this.isInfoOn=!0,this.isTimeOn=!0;function o(t){return"number"==typeof t&&-90<=t&&t<=90}function r(t){return"number"==typeof t&&-180<=t&&t<=180}function l(t){return"number"==typeof t&&0<=t&&t<=18}function a(i){for(var e=(new Date).getTime()/1e3-i,n=[{b:10,f:"現在"},{b:6,f:"不到 1 分鐘"},{b:60,f:" 分鐘前"},{b:24,f:" 小時前"},{b:30,f:" 天前"},{b:12,f:" 個月前"}],s=1,l=0;l<n.length;l++,s=t)if(t=n[l].b*s,e<t)return(1<l?parseInt(e/s,10):"")+n[l].f;return parseInt(e/s,10)+" 年前"}function h(t){return t.replace(new RegExp("\r?\n","g"),"<br />")}function c(t){return new google.maps.LatLng(t[0].lat,t[0].lng)}function u(t){return null!==t}function f(t){return t.map&&t.setMap(null),null}function p(){return"undefined"==typeof google||void 0===google.maps||void 0===google.maps.Map?this:(null!==this.gmap||null===this.mapEl||o(this.lat)&&r(this.lng)&&l(this.zoom)&&(this.gmap=new google.maps.Map(this.mapEl,{zoom:this.zoom,clickableIcons:!1,disableDefaultUI:!0,gestureHandling:"greedy",center:new google.maps.LatLng(this.lat,this.lng)}),this.gmap.mapTypes.set("ms",new google.maps.StyledMapType([{stylers:[{gamma:0},{weight:.75}]},{featureType:"all",stylers:[{visibility:"on"}]},{featureType:"administrative",stylers:[{visibility:"on"}]},{featureType:"landscape",stylers:[{visibility:"on"}]},{featureType:"poi",stylers:[{visibility:"on"}]},{featureType:"road",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{visibility:"on"}]},{featureType:"transit",stylers:[{visibility:"on"}]},{featureType:"water",stylers:[{color:"#b3d1ff",visibility:"on"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]}])),this.gmap.setMapTypeId("ms"),this.gmap.addListener("idle",function(){this.gmap.zoom!==k&&(k=this.gmap.zoom,clearTimeout(C),C=setTimeout(O.bind(this),300))}.bind(this))),O.call(this))}function m(t,i,e,n,s){if(!t.length)return s?s([]):[];for(var l={},o=[],r=n?t.length-1:t.length,a=0;a<t.length;a++)if(void 0===l[a]){l[a]=!0;for(var h=[t[a]],c=a+1;c<r;c++)if(void 0===l[c]){var u=Math.max(Math.abs(t[a].lat-t[c].lat),Math.abs(t[a].lng-t[c].lng));if(30/Math.pow(2,i)/e<=u){if(n)break}else l[c]=!0,h.push(t[c])}else if(n)break;o.push(h)}return l=null,s?s(o):o}function g(){return w.forEach(function(t){return t.times=t.times.map(f).filter(u),this.isTimeOn?m.call(this,t.markers,this.gmap.zoom,2,!1,function(e){var n=function(t){var i=t.length/5;return parseInt(t.length/(10<i?10:i<1?1:i),10)}(e);t.times=e.filter(function(t,i){return i%n==0||i==e.length-1}).map(function(t,i){var e=a(i[0].time);return L({map:this.gmap,position:c(i),width:10,height:10,className:"timeMarker "+t.timeAlign,html:"<i style='background-color: rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", 1)'></i><div>"+e+"</div>"})}.bind(this,t)).filter(u)}.bind(this)):this}.bind(this)),this}function v(){return b=b.map(f).filter(u),this.isInfoOn&&m.call(this,y,this.gmap.zoom,.5,!1,function(t){b=t.map(function(t){return L({map:this.gmap,position:c(t),width:10,height:10,className:"infoMarker",html:1==t.length?"<div>"+h(t[0].text)+"</div>":"<b>"+t.length+"</b>"})}.bind(this)).filter(u)}.bind(this)),this}var d=null,y=[],w=[],b=[],k=null,C=null,x=!1,O=function(){return null!==this.gmap?function(){if(x||!w.length)return this;var i=new google.maps.LatLngBounds;return w.forEach(function(t){t.markers.forEach(function(t){i.extend(c([t]))})}),this.gmap.fitBounds(i),x=!0,this}.call(function(){return null===d||d instanceof L||(d=L({map:this.gmap,position:c([d]),width:40,height:70,top:-35,className:"mazuMarker",html:(d.info?"<div>"+h(d.info)+"</div>":"")+"<img src='/img/mz.png'/>"})),this}.call(v.call(g.call(function(){return w.filter(function(t){return null===t.polyline}).forEach(function(t){return t.polyline=new google.maps.Polyline({map:this.gmap,strokeWeight:5,strokeColor:"rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+t.color.a+")"})}.bind(this)),w.forEach(function(i){return m.call(this,i.markers,this.gmap.zoom,1,!0,function(t){i.polyline.setPath(t.map(c))}.bind(this))}.bind(this)),this}.call(this))))):this};this.setMap=function(t){return"object"==typeof t&&t instanceof HTMLDivElement&&(this.mapEl=t)&&p.call(this),this},this.setLat=function(t){return o(t)&&(this.lat=t,p.call(this)),this},this.setLng=function(t){return r(t)&&(this.lng=t,p.call(this)),this},this.setZoom=function(t){return l(t)&&(this.zoom=t,p.call(this)),this},this.zoomInOut=function(t){return this.gmap&&this.gmap.setZoom(this.gmap.zoom+t),this},this.clickInfo=function(){return this.isInfoOn=!this.isInfoOn,O.call(this),this},this.clickTime=function(){return this.isTimeOn=!this.isTimeOn,O.call(this),this},this.setTitle=function(t){return"string"==typeof t&&t&&(this.title=t),this},this.appendLength=function(t,i){return"string"==typeof t&&t&&"number"==typeof i&&this.lengths.push({title:t,length:i}),this},this.setInfos=function(t){return"object"==typeof t&&Array.isArray(t)&&(y=t.reverse().map(function(t){var i="number"==typeof t.lat&&o(t.lat)?t.lat:null,e="number"==typeof t.lng&&r(t.lng)?t.lng:null,n="string"==typeof t.text&&t.text?t.text:null;return null===i||null===e||null===n?null:{lat:i,lng:e,text:n}}).filter(function(t){return null!==t})),this},this.setLines=function(t){return"object"==typeof t&&Array.isArray(t)&&(w=t.map(function(t){var i="string"==typeof t.title&&t.title?t.title:null,e="number"==typeof t.length?t.length:null,n="object"==typeof t.color&&Array.isArray(t.color)&&4==t.color.length?{r:t.color[0],g:t.color[1],b:t.color[2],a:t.color[3]}:null,s="string"==typeof t.timeAlign&&-1!==["left","center","right"].indexOf(t.timeAlign)?t.timeAlign:"center",l=t.markers.map(function(t){var i="number"==typeof t.lat&&o(t.lat)?t.lat:null,e="number"==typeof t.lng&&r(t.lng)?t.lng:null,n="number"==typeof t.time?t.time:null;return null===i||null===e||null===n?null:{lat:i,lng:e,time:n}}).filter(function(t){return null!==t});return null!==i&&null!==e&&null!==n&&l.length?this.appendLength(i,e)&&{polyline:null,times:[],title:i,length:e,color:n,timeAlign:s,markers:l}:null}.bind(this)).filter(function(t){return null!==t})),this},this.setFormat=function(t){return"number"==typeof t.lat&&o(t.lat)&&"number"==typeof t.lng&&r(t.lng)&&(d={lat:t.lat,lng:t.lng,info:"string"==typeof t.info&&t.info?t.info:null}),"string"==typeof t.title&&t.title&&this.setTitle(t.title),"number"==typeof t.length&&t.length&&this.appendLength("全部累計",t.length),"object"==typeof t.infos&&Array.isArray(t.infos)&&this.setInfos(t.infos),"object"==typeof t.lines&&Array.isArray(t.lines)&&this.setLines(t.lines),p.call(this)},this.url=function(t){return"string"==typeof t&&$.get(t).done(this.setFormat.bind(this)),this},this.addClass("HMV").setLat(i).setLng(e).setZoom(n).url(s)}function k(t){if(!(this instanceof k))return new k(t);o.call(this),this.historyMapView=this.view=j(24.571414629893,120.70938291783,10,t),this.url=this.historyMapView.url.bind(this.historyMapView)}T("v",{props:{view:A,controller:o},mounted:function(){this.view.controller=this.controller},computed:{on:function(){for(var t in this.view.on)"function"==typeof this.view.on[t]?this.view.on[t]=this.view.on[t].bind(this.view):delete this.view.on[t];return this.view.on}},template:l(["@is=view.el","@class=view.class","@on=on","@text=view.text"])}),T("atv",{props:{view:A,controller:o},mounted:function(){this.view.controller=this.controller},computed:{isLoading:function(){return!this.view.isLoaded},timeAt:function(){return this.isLoading?null:this.view.timeAt},sections:function(){return this.isLoading?[]:this.view.sections},references:function(){return this.isLoading?[]:this.view.references}},template:l(["@is=view.el","@class=[view.class, { loading: isLoading }]"],[l("section",["@for=(section, i) in sections","@key=i"],[l("h2",["@if=section.title","@text=section.title"]),l(["@for=(token, j) in section.tokens","@key=j",'@is=token.type=="text"?"p":"figure"','@style=token.type=="image"?{ backgroundImage: "url(" + token.url + ")" }:{}'],['{{ token.type == "text" ? token.val : null }}',l("figcaption",['@if=token.type!="text"&&token.val',"@text=token.val"])])]),l("time",["@if=timeAt","@text=timeAt"]),l("ul",["@if=references.length"],l("li",["@for=(reference, i) in references","@key=i"],["{{ !reference.link ? reference.title : null }}",l("a",["@if=reference.link","@href=reference.link","@text=reference.title ? reference.title : reference.link"])]))])}),T("hmv",{props:{view:A,controller:o},mounted:function(){this.view.controller=this.controller,this.view.setMap(this.$refs.map)},computed:{laoding:function(){return!this.view.gmap},title:function(){return this.view.title},lengths:function(){return this.laoding?[]:this.view.lengths},zoomIn:function(){return this.view.zoomInOut.bind(this.view,1)},zoomOut:function(){return this.view.zoomInOut.bind(this.view,-1)},clickInfo:function(){return this.view.clickInfo.bind(this.view)},clickTime:function(){return this.view.clickTime.bind(this.view)}},template:l(["@is=view.el","@class=view.class"],[l("div",['@class=["map", { Vl: laoding, loading: laoding }]',"ref=map"]),l("label",["@if=!laoding","@class={ info: true, on: view.isInfoOn }",'@text="路徑資訊"',"@click=clickInfo"]),l("label",["@if=!laoding","@class={ time: true, on: view.isTimeOn }",'@text="時間紀錄"',"@click=clickTime"]),l("div",["@if=!laoding","class=lengths"],l("span",["@for=(length, i) in lengths","@key=i","@text=length.length","@data-title=length.title"])),l("div",["@if=!laoding","class=zoom"],[l("label",["@click=zoomIn"]),l("label",["@click=zoomOut"])])])}),T("tv-cl",{props:{cell:u,section:f,tableview:p,controller:o},mounted:function(){this.cell.section=this.section,this.cell.tableView=this.tableview,this.cell.controller=this.controller},computed:{el:function(){return"switch"==this.cell.marker?"div":"label"},image:function(){return null!==this.cell.image?"icon"===this.cell.image.type?{class:this.cell.image.val,style:{}}:{class:null,style:{backgroundImage:"url("+this.cell.image.val+")"}}:null},title:function(){return"string"==typeof this.cell.title?this.cell.title:""},detail:function(){return"input"!=this.cell.marker&&"text"!=this.cell.marker?"string"==typeof this.cell.detail?this.cell.detail:"":null},textInput:function(){return"input"!=this.cell.marker&&"text"!=this.cell.marker?null:{el:"input"==this.cell.marker?"input":"textarea",type:"input"==this.cell.marker?"text":null,placeholder:"string"==typeof this.cell.detail&&this.cell.detail?this.cell.detail:""}},error:{set:function(t){this.cell.error=t},get:function(){return("input"==this.cell.marker||"text"==this.cell.marker)&&"string"==typeof this.cell.error&&this.cell.error?this.cell.error:null}},marker:function(){return-1!==["switch","arrow","check"].indexOf(this.cell.marker)?"switch"==this.cell.marker?"label":"i":null},onEl:function(){return"switch"==this.cell.marker?{}:"check"==this.cell.marker?{click:this.tableview.checkCellOnly.bind(this.tableview,this.cell)}:"function"==typeof this.cell.click?{click:this.cell.click.bind(this.cell)}:{}},onMarker:function(){return"switch"==this.cell.marker&&"function"==typeof this.cell.click?{click:this.cell.click.bind(this.cell)}:{}},className:function(){var t=this.cell.classList();return this.cell.image&&t.push(this.cell.image.type),this.cell.align&&t.push(this.cell.align),this.cell.color&&t.push(this.cell.color),this.cell.wrap&&t.push(this.cell.wrap),this.cell.marker&&t.push(this.cell.marker),!this.cell.isOn||"switch"!=this.cell.marker&&"check"!=this.cell.marker||t.push("on"),"input"!=this.cell.marker&&"text"!=this.cell.marker&&this.cell.layout&&t.push(this.cell.layout),t.filter(function(t){return null!==t}).join(" ")}},template:l(["@is=el","@class=className","@on=onEl"],[l("figure",["@if=image","@class=image.class","@style=image.style"]),l("b",["@if=title","@text=title"]),l("span",["@if=detail","@text=detail"]),l("span",["@if=textInput"],[l("input",['@if=textInput.el=="input"',"@type=textInput.type","@placeholder=textInput.placeholder","@focus=error=null","@model=cell.value"]),l("textarea",['@if=textInput.el=="textarea"',"@type=textInput.type","@placeholder=textInput.placeholder","@focus=error=null","@model=cell.value"]),l("u",["@if=error","@text=error"])]),l(["@if=marker","@is=marker","@on=onEl"])])}),T("tv-h",{props:{header:e,section:f,tableview:p,controller:o},mounted:function(){this.header.section=this.section,this.header.tableview=this.tableview,this.header.controller=this.controller},template:l(["@is=header.el","@class=header.class","@html=header.html"])}),T("tv-f",{props:{footer:c,section:f,tableview:p,controller:o},mounted:function(){this.footer.section=this.section,this.footer.tableview=this.tableview,this.footer.controller=this.controller},template:l(["@is=footer.el","@class=footer.class","@html=footer.html"])}),T("tv-s",{props:{section:f,tableview:p,controller:o},mounted:function(){this.section.tableView=this.tableview,this.tableview.controller=this.controller},computed:{header:function(){return this.section.header&&this.section.header instanceof e&&this.section.header},footer:function(){return this.section.footer&&this.section.footer instanceof c&&this.section.footer},rows:function(){return this.section.rows.filter(function(t){return t instanceof u})}},template:l(["@is=section.el","@class=section.class"],[l(["@if=header","@is=header.component","@header=header","@section=section","@tableview=tableview","@controller=controller"]),l(["@for=(row, i) in rows","@key=i","@is=row.component",'@class=[i == 0 ? "first" : null, i == rows.length - 1 ? "last" : null]',"@cell=row","@section=section","@tableview=tableview","@controller=controller"]),l(["@if=footer","@is=footer.component","@footer=footer","@section=section","@tableview=tableview","@controller=controller"])])}),T("tv",{props:{view:A,controller:o},mounted:function(){this.view.controller=this.controller},computed:{isLoading:function(){return!Array.isArray(this.view.sections)},sections:function(){return this.isLoading?[]:this.view.sections.filter(function(t){return t instanceof f})}},template:l(["@is=view.el","@class=[view.class, { loading: isLoading }]"],l(["@for=(section, i) in sections","@key=i","@is=section.component","@section=section","@tableview=view","@controller=controller"]))}),T("acv",{props:{view:A,controller:o},mounted:function(){this.view.controller=this.controller},computed:{btns:function(){return this.view.buttons}},template:l(["@if=view.title || view.message || btns.length","@is=view.el","@class=view.class"],[l("div",["@if=view.title || view.message","class=Info"],[l("b",['@if=typeof view.title === "string" && view.title',"@text=view.title"]),l("span",['@if=typeof view.message === "string" && view.message',"@text=view.message"])]),l("div",["@if=btns.length","class=Btns"],l(["@for=(btn, i) in btns","@key=i","@is=btn.component","@view=btn","@controller=controller"]))])}),T("vc",{props:{controller:o,navigation:a},mounted:function(){this.controller.navigationController=this.navigation},template:l("div",["@class=controller.class"],[l(["@if=navigation && controller.navigationBar","@is=controller.navigationBar.component","@bar=controller.navigationBar","@controller=controller","@navigation=navigation"]),l(["@if=controller.view","@is=controller.view.component","@view=controller.view","@controller=controller"])])}),T("nav-bar",{props:{bar:r,controller:o,navigation:a},mounted:function(){this.bar.controller=this.controller,this.bar.navigationController=this.navigation,this.bar.left&&(this.bar.left.navigationBar=this.bar),this.bar.left&&(this.bar.left.controller=this.controller),this.bar.left&&(this.bar.left.navigationController=this.navigation),this.bar.title&&(this.bar.title.navigationBar=this.bar),this.bar.title&&(this.bar.title.controller=this.controller),this.bar.title&&(this.bar.title.navigationController=this.navigation),this.bar.right&&(this.bar.right.navigationBar=this.bar),this.bar.right&&(this.bar.right.controller=this.controller),this.bar.right&&(this.bar.right.navigationController=this.navigation)},template:l("div",["@class=bar.class"],[l(["@if=bar.left","@is=bar.left.component","@view=bar.left","@controller=controller"]),l(["@if=bar.title","@is=bar.title.component","@view=bar.title","@controller=controller"]),l(["@if=bar.right","@is=bar.right.component","@view=bar.right","@controller=controller"])])}),T("nc",{props:{controller:a},computed:{vcs:function(){return this.controller.viewControllers.filter(function(t){return t instanceof o})}},template:l("div",["@class=controller.class"],l(["@for=(vc, i) in vcs","@key=i","@is=vc.component","@controller=vc","@navigation=controller"]))}),n.main=function(){return this._main?this._main:this._main=n()},n.body=function(){return this._body?this._body:this._body=$("body")},A.prototype=Object.create(i.prototype),o.prototype=Object.create(i.prototype),s.prototype=Object.create(A.prototype),r.prototype=Object.create(A.prototype),a.prototype=Object.create(o.prototype),h.prototype=Object.create(o.prototype),u.prototype=Object.create(A.prototype),e.prototype=Object.create(A.prototype),c.prototype=Object.create(A.prototype),f.prototype=Object.create(A.prototype),p.prototype=Object.create(A.prototype),m.prototype=Object.create(o.prototype),g.prototype=Object.create(p.prototype),v.prototype=Object.create(m.prototype),d.prototype=Object.create(A.prototype),y.prototype=Object.create(o.prototype),w.prototype=Object.create(d.prototype),b.prototype=Object.create(y.prototype),j.prototype=Object.create(A.prototype),k.prototype=Object.create(o.prototype),C.keys=["AIzaSyBF02Xytwx2peyWWpiUwkQDgng_FYmnBaA"],C.finish=function(){var t=v("menu.json");t.setTitle("標題"),t.setRight("新增"),t.setLeft("關閉"),a(t).present()},C()});