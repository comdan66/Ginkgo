/*
 * @author      OA Wu <comdan66@gmail.com>
 * @copyright   Copyright (c) 2015 - 2019, Ginkgo
 * @license     http://opensource.org/licenses/MIT  MIT License
 * @link        https://www.ioa.tw/
 */

$(function(){function t(t){return $("<"+t+" />")}function e(){return t("b")}function n(){return t("div")}function l(){return t("figure")}function i(){return t("i")}function o(){return t("label")}function s(){return t("span")}function r(){return t("u")}function c(){return t("component")}function a(t,e){if(!(this instanceof a))return new a(t,e);var n=[],l=!1;return this.delay=function(t,e){return"function"==typeof t&&n.push({func:t,ttl:e}),this},this.stop=function(){l=!0},this.run=function(){return function t(){var e=n.shift();return e&&!0!==l?"number"==typeof e.ttl?setTimeout(function(){if(!0!==l)return l=!1===e.func(),t()},e.ttl):(l=!1===e.func(),t()):this}(),this},"function"==typeof t?"number"==typeof e?setTimeout(t,e):t():this}function h(t){if(!(this instanceof h))return new h(t);(t=t&&t instanceof jQuery?t:n().addClass("Window")).attr("v-if","display").attr(":class","{ show: isShow }").append(c().attr("v-for","(viewController, i) in viewControllers").attr(":key","i").attr(":is","viewController.component").attr(":controller","viewController"));var l=new Vue({el:t.appendTo(h.body()).get(0),data:{display:!1,isShow:!1,viewControllers:[]},methods:{nowViewController:function(){return 0<this.viewControllers.length?this.viewControllers[this.viewControllers.length-1]:null}}});this.present=function(t,e,n){if(!(t&&t instanceof p))return this;a().delay(function(){l.isShow=!0,l.viewControllers.push(t)},l.display||!(l.display=!0)||!1===n||10).delay(function(){t.addClass("present")},!1===n||10).delay("function"==typeof e&&e.bind(t),!1===n||290).run()},this.dismiss=function(t,e,n){return t&&t instanceof p?t!==l.nowViewController()?this:void a().delay(function(){t.removeClass("present")},null).delay(function(){l.viewControllers.pop()},!1===n||300).delay("function"==typeof e&&e.bind(t),null).delay(function(){l.viewControllers.length||(l.isShow=!1)},!1===n||300).delay(function(){l.isShow||(l.display=!1)},null).run():this},option=null,delete option}function u(t){if(!(this instanceof u))return new u(t);this.class="string"==typeof t?t:"",this.click=null,this.classList=function(){return this.class.split(/\s+/)},this.hasClass=function(e){return 0!=this.classList().filter(function(t){return t===e}).length},this.addClass=function(t){if("string"!=typeof t||!(t=t.trim()))return this;if(this.hasClass(t))return this;var e=this.classList();return e.push(t),this.class=e.join(" "),this},this.removeClass=function(e){return"string"==typeof e&&(e=e.trim())&&this.hasClass(e)&&(this.class=this.classList().filter(function(t){return t!=e}).join(" ")),this}}function p(){if(!(this instanceof p))return new p;u.call(this,"ViewController"),this.component=Vue.component("view-controller"),this.navigationController=null,this.navigationBar=d(),this.view=f(),this.present=function(t,e){h.main().present(this.navigationController||this,t,e)},this.dismiss=function(t,e){h.main().dismiss(this.navigationController||this,t,e)},this.pop=function(t,e){return this.navigationController?this.navigationController.pop(t,e):this},this.push=function(t,e,n){return this.navigationController?this.navigationController.push(t,e,n):this}}function f(t){if(!(this instanceof f))return new f(t);u.call(this,"View"),this.component=Vue.component("view"),this.text="",this.controller=null,this.element="string"==typeof t&&t.length?t:"div"}function v(t){if(!(this instanceof v))return new v(t);f.call(this,t),this.class=""}function d(){if(!(this instanceof d))return new d;f.call(this),this.component=Vue.component("navigation-bar"),this.class="NavigationBar",this.left=v("label"),this.title=v("header"),this.right=v("label")}function w(t){if(!(this instanceof w))return new w(t);p.call(this);var i=!1;this.component=Vue.component("navigation-controller"),this.viewControllers=[],this.nowViewController=function(){return 0<this.viewControllers.length?this.viewControllers[this.viewControllers.length-1]:null},this.lastViewController=function(){return 0<this.viewControllers.length-1?this.viewControllers[this.viewControllers.length-2]:null},this.push=function(t,e,n){if(i)return this;if(!(t&&t instanceof p)||t instanceof w)return this;this.viewControllers.push(t);var l=this.lastViewController();return l&&!t.navigationBar.left.text&&(t.navigationBar.left.text="返回",t.navigationBar.left.class="back",t.navigationBar.left.click=this.pop.bind(this)),i=!0,a().delay(function(){t.addClass("push")&&l&&l.addClass("ed").addClass("last")},!1===n||10).delay("function"==typeof e&&e.bind(this),!1===n||390).delay(function(){i=!1}.bind(this)).run(),this},this.pop=function(t,e){if(i)return this;var n=this.nowViewController(),l=this.lastViewController();return null===l?this.dismiss(t,e):(n.removeClass("push")&&l.removeClass("last"),i=!0,a().delay(function(){l.removeClass("ed"),this.viewControllers.pop()}.bind(this),!1===e||400).delay("function"==typeof t&&t.bind(this),null).delay(function(){i=!1}.bind(this)).run(),this)},this.addClass("NavigationController").push(t,null,!1)}function m(t){if(!(this instanceof m))return new m(t);this.val=t}function y(t){if(!(this instanceof y))return new y(t);this.val=t}function b(t){if(!(this instanceof b))return new b(t);this.val=t}function g(t,e,n,l,i){if(!(this instanceof g))return new g(t,e,n,l,i);f.call(this),this.component=Vue.component("table-view-cell"),this.section=null,this.tableView=null,this.class="TableViewCell",this.icon="string"==typeof t?t:null,this.title="string"==typeof e?e:null,this.detail="string"==typeof n?n:null,this.layout=l instanceof m?l:null,this.isWrap=null,this.click="function"==typeof i?i:null,this.align=null,this.color=null,this.name=null,this.val=null,this.check=null}function C(t,e,n,l,i){if(!(this instanceof C))return new C(t,e,n,l,i);g.call(this,t,e,n,l,i),this.component=Vue.component("table-view-cell-arrow"),this.addClass("arrow")}function V(t,e,n,l,i){if(!(this instanceof V))return new V(t,e,n,l,i);g.call(this,t,e,n,l,i),this.component=Vue.component("table-view-cell-switch"),this.isOn=!1,this.addClass("switch")}function k(t,e,n,l,i){if(!(this instanceof k))return new k(t,e,n,l,i);g.call(this,t,e,n,l,i),this.component=Vue.component("table-view-cell-checkmark"),this.isOn=!1,this.addClass("checkmark")}function O(t,e){if(!(this instanceof O))return new O(t,e);g.call(this,null,t,e),this.component=Vue.component("table-view-cell-input"),this.addClass("input"),this.error=null}function j(t,e){if(!(this instanceof j))return new j(t,e);g.call(this,null,t,e),this.component=Vue.component("table-view-cell-text"),this.addClass("text"),this.error=null}function x(){if(!(this instanceof x))return new x;f.call(this),this.component=null,this.class="",this.html=null}function L(t){if(!(this instanceof L))return new L(t);f.call(this),this.component=Vue.component("table-view-section"),this.class="TableViewSection",this.rows=void 0!==t&&$.isArray(t)?t:[],this.header=null,this.footer=null,this.tableView=null}function T(){if(!(this instanceof T))return new T;f.call(this),this.component=Vue.component("table-view"),this.addClass("TableView"),this.sections=[],this.rows=function(){return this.sections.filter(function(t){return t instanceof L}).map(function(t){return t.rows.filter(function(t){return t instanceof g})}).reduce(function(t,e){return t.concat(e)})},this.vals=function(){if(!this.check())return null;var t=this.rows().filter(function(t){return"string"==typeof t.name&&t.name.length}).filter(function(t){return!(t instanceof k||t instanceof V)||t.isOn}),e={};for(var n in t)e[t[n].name]=t[n].val;return e},this.check=function(){return!this.rows().filter(function(t){return"string"==typeof t.name&&t.name.length}).filter(function(t){return"function"==typeof t.check}).filter(function(t){return t.error="function"==typeof t.check?t.check():null}).length}}function N(){if(!(this instanceof N))return new N;p.call(this),this.tableView=this.view=T(),this.sections=this.view.sections}Vue.component("view",{props:{view:f,controller:p},mounted:function(){this.view.controller=this.controller},template:c().attr(":class","view.class").attr("v-if",'typeof this.view.element === "string" && this.view.element.length').attr(":is","this.view.element").attr("v-on:click.stop",'typeof view.click === "function" ? view.click.call(view) : {}').text("{{ view.text }}").prop("outerHTML")}),Vue.component("navigation-bar",{props:{bar:d,controller:p},mounted:function(){this.bar.controller=this.controller},template:n().attr(":class","bar.class").attr("v-if:","controller").append(c().attr("v-if","bar.left").attr(":is","bar.left && bar.left.component").attr(":view","bar.left").attr(":controller","controller")).append(c().attr("v-if","bar.title").attr(":is","bar.title && bar.title.component").attr(":view","bar.title").attr(":controller","controller")).append(c().attr("v-if","bar.right").attr(":is","bar.right && bar.right.component").attr(":view","bar.right").attr(":controller","controller")).prop("outerHTML")}),Vue.component("table-view-cell",{props:{cell:g,section:L,tableview:T,controller:p},mounted:function(){this.cell.section=this.section,this.cell.tableView=this.tableview,this.cell.controller=this.controller},computed:{click:function(){return"function"==typeof this.cell.click?this.cell.click.bind(this.cell):function(){}},className:function(){var t=this.cell.classList();return this.cell.layout instanceof m||(this.cell.layout=m.none),"string"==typeof this.cell.detail&&this.cell.detail.length&&this.cell.layout==m.none&&(this.cell.layout=m.subtitle),t.push(this.cell.layout.val),this.cell.icon&&t.push("icon"),!0===this.cell.isWrap&&t.push("wrap"),this.cell.align instanceof y&&t.push(this.cell.align.val),this.cell.color instanceof b&&t.push(this.cell.color.val),t.filter(function(t){return null!==t}).join(" ")}},template:o().attr("v-on:click.stop","click").attr(":class","className").append(l().attr("v-if","cell.icon").attr(":class","cell.icon")).append(e().text("{{ cell.title }}")).append(s().attr("v-if",'typeof cell.detail === "string" && cell.detail.length').text("{{ cell.detail }}")).prop("outerHTML")}),Vue.component("table-view-cell-switch",{props:{cell:g,section:L,tableview:T,controller:p},mounted:function(){this.cell.section=this.section,this.cell.tableView=this.tableview,this.cell.controller=this.controller},computed:{click:function(){return"function"==typeof this.cell.click?this.cell.click.bind(this.cell):function(){}},className:function(){var t=this.cell.classList();return this.cell.layout instanceof m||(this.cell.layout=m.none),"string"==typeof this.cell.detail&&this.cell.detail.length&&this.cell.layout==m.none&&(this.cell.layout=m.subtitle),t.push(this.cell.layout.val),this.cell.icon&&t.push("icon"),!0===this.cell.isOn&&t.push("on"),!0===this.cell.isWrap&&t.push("wrap"),this.cell.align instanceof y&&t.push(this.cell.align.val),this.cell.color instanceof b&&t.push(this.cell.color.val),t.filter(function(t){return null!==t}).join(" ")}},template:n().attr(":class","className").append(l().attr("v-if","cell.icon").attr(":class","cell.icon")).append(e().text("{{ cell.title }}")).append(s().attr("v-if",'typeof cell.detail === "string" && cell.detail.length').text("{{ cell.detail }}")).append(o().attr("v-on:click.stop","click")).prop("outerHTML")}),Vue.component("table-view-cell-arrow",{props:{cell:g,section:L,tableview:T,controller:p},mounted:function(){this.cell.section=this.section,this.cell.tableView=this.tableview,this.cell.controller=this.controller},computed:{click:function(){return"function"==typeof this.cell.click?this.cell.click.bind(this.cell):function(){}},className:function(){var t=this.cell.classList();return this.cell.layout instanceof m||(this.cell.layout=m.none),"string"==typeof this.cell.detail&&this.cell.detail.length&&this.cell.layout==m.none&&(this.cell.layout=m.subtitle),t.push(this.cell.layout.val),this.cell.icon&&t.push("icon"),!0===this.cell.isOn&&t.push("on"),!0===this.cell.isWrap&&t.push("wrap"),this.cell.align instanceof y&&t.push(this.cell.align.val),this.cell.color instanceof b&&t.push(this.cell.color.val),t.filter(function(t){return null!==t}).join(" ")}},template:o().attr(":class","className").attr("v-on:click.stop","click").append(l().attr("v-if","cell.icon").attr(":class","cell.icon")).append(e().text("{{ cell.title }}")).append(s().attr("v-if",'typeof cell.detail === "string" && cell.detail.length').text("{{ cell.detail }}")).append(i()).prop("outerHTML")}),Vue.component("table-view-cell-checkmark",{props:{cell:g,section:L,tableview:T,controller:p},mounted:function(){this.cell.section=this.section,this.cell.tableView=this.tableview,this.cell.controller=this.controller},computed:{click:function(){return"function"==typeof this.cell.click?this.cell.click.bind(this.cell):function(){}},className:function(){var t=this.cell.classList();return this.cell.layout instanceof m||(this.cell.layout=m.none),"string"==typeof this.cell.detail&&this.cell.detail.length&&this.cell.layout==m.none&&(this.cell.layout=m.subtitle),t.push(this.cell.layout.val),this.cell.icon&&t.push("icon"),!0===this.cell.isOn&&t.push("on"),!0===this.cell.isWrap&&t.push("wrap"),this.cell.align instanceof y&&t.push(this.cell.align.val),this.cell.color instanceof b&&t.push(this.cell.color.val),t.filter(function(t){return null!==t}).join(" ")}},methods:{check:function(){return"string"==typeof this.cell.name&&this.cell.name.length?(this.cell.isOn=!0,this.cell.tableView.rows().filter(function(t){return t instanceof k&&"string"==typeof t.name&&t.name.length&&t.name==this.cell.name&&t!=this.cell}.bind(this)).forEach(function(t){t.isOn=!1}),this.click(!0)):this.click(this.cell.isOn=!this.cell.isOn)}},template:o().attr(":class","className").attr("v-on:click.stop","check").append(l().attr("v-if","cell.icon").attr(":class","cell.icon")).append(e().text("{{ cell.title }}")).append(s().attr("v-if",'typeof cell.detail === "string" && cell.detail.length').text("{{ cell.detail }}")).append(i()).prop("outerHTML")}),Vue.component("table-view-cell-input",{props:{cell:g,section:L,tableview:T,controller:p},mounted:function(){this.cell.section=this.section,this.cell.tableView=this.tableview,this.cell.controller=this.controller},computed:{className:function(){var t=this.cell.classList();return this.cell.icon&&t.push("icon"),!0===this.cell.isWrap&&t.push("wrap"),this.cell.align instanceof y&&t.push(this.cell.align.val),this.cell.color instanceof b&&t.push(this.cell.color.val),t.filter(function(t){return null!==t}).join(" ")}},template:o().attr(":class","className").append(l().attr("v-if","cell.icon").attr(":class","cell.icon")).append(e().attr("v-if","cell.title").text("{{ cell.title }}")).append(s().append(t("input").attr(":type",'"text"').attr(":placeholder","cell.detail").attr("v-on:focus","cell.error = null").attr("v-model.trim","cell.val")).append(r().attr("v-if",'typeof cell.error === "string" && cell.error.length').text("{{ cell.error }}"))).prop("outerHTML")}),Vue.component("table-view-cell-text",{props:{cell:g,section:L,tableview:T,controller:p},mounted:function(){this.cell.section=this.section,this.cell.tableView=this.tableview,this.cell.controller=this.controller},computed:{className:function(){var t=this.cell.classList();return this.cell.icon&&t.push("icon"),!0===this.cell.isWrap&&t.push("wrap"),this.cell.align instanceof y&&t.push(this.cell.align.val),this.cell.color instanceof b&&t.push(this.cell.color.val),t.filter(function(t){return null!==t}).join(" ")}},template:o().attr(":class","className").append(l().attr("v-if","cell.icon").attr(":class","cell.icon")).append(e().attr("v-if","cell.title").text("{{ cell.title }}")).append(s().append(t("textarea").attr(":placeholder","cell.detail").attr("v-on:focus","cell.error = null").attr("v-model.trim","cell.val")).append(r().attr("v-if",'typeof cell.error === "string" && cell.error.length').text("{{ cell.error }}"))).prop("outerHTML")}),Vue.component("table-view-section",{props:{section:L,tableview:T,controller:p},mounted:function(){this.section.tableView=this.tableview,this.section.controller=this.controller},computed:{rows:function(){return this.section.rows.filter(function(t){return t instanceof g})},headerIsView:function(){return this.section.header instanceof x},footerIsView:function(){return this.section.footer instanceof x}},template:t("section").attr(":class","section.class").attr(":data-header",'typeof section.header === "string" ? section.header : null').attr(":data-footer",'typeof section.footer === "string" ? section.footer : null').append(t("header").attr("v-if","headerIsView").attr("v-html","section.header.html")).append(c().attr("v-for","(row, i) in rows").attr(":key","i").attr(":is","row.component").attr(":cell","row").attr(":section","section").attr(":tableview","tableview").attr(":controller","controller").attr(":class",'[i == 0 ? "first" : null, i == rows.length - 1 ? "last" : null]')).append(t("footer").attr("v-if","footerIsView").attr("v-html","section.footer.html")).prop("outerHTML")}),Vue.component("table-view",{props:{view:T,controller:p},mounted:function(){this.view.controller=this.controller},computed:{sections:function(){return this.view.sections.filter(function(t){return t instanceof L})}},template:n().attr(":class","view.class").attr(":data-title","view.text").append(c().attr("v-for","(section, i) in sections").attr(":key","i").attr(":is","section.component").attr(":section","section").attr(":tableview","view").attr(":controller","controller")).prop("outerHTML")}),Vue.component("view-controller",{props:{controller:p,navigation:w},mounted:function(){this.controller.navigationController=this.navigation},template:n().attr(":class","controller.class").append(c().attr(":is","controller.navigationBar && controller.navigationBar.component").attr(":bar","controller.navigationBar").attr(":controller","controller").attr("v-if","navigation")).append(c().attr(":is","controller.view && controller.view.component").attr(":view","controller.view").attr(":controller","controller")).prop("outerHTML")}),Vue.component("navigation-controller",{props:{controller:w},template:n().attr(":class","controller.class").append(c().attr("v-for","(viewController, i) in controller.viewControllers").attr(":key","i").attr(":is","viewController.component").attr(":controller","viewController").attr(":navigation","controller")).prop("outerHTML")}),p.prototype=Object.create(u.prototype),f.prototype=Object.create(u.prototype),v.prototype=Object.create(f.prototype),d.prototype=Object.create(f.prototype),w.prototype=Object.create(p.prototype),N.prototype=Object.create(p.prototype),x.prototype=Object.create(f.prototype),L.prototype=Object.create(f.prototype),T.prototype=Object.create(f.prototype),g.prototype=Object.create(f.prototype),V.prototype=Object.create(g.prototype),C.prototype=Object.create(g.prototype),k.prototype=Object.create(g.prototype),O.prototype=Object.create(g.prototype),j.prototype=Object.create(g.prototype),m.none=m(null),m.subtitle=m("subtitle"),m.value=m("value"),y.none=y(null),y.left=y("left"),y.center=y("center"),y.right=y("right"),b.none=b(null),b.blue=b("blue"),b.red=b("red"),h.main=function(){return this._main?this._main:this._main=h({class:"Window"})},h.body=function(){return this._body?this._body:this._body=$("body")};var H=N();H.tableView.sections=[L([O("標題","副標題"),j("標題","副標題"),O(null,"副標題"),j(null,"副標題")]),L([g(),C(),V(),k()]),L([g("icon-2e"),C("icon-2e"),V("icon-2e"),k("icon-2e")]),L([g("icon-2e","標題"),C("icon-2e","標題"),V("icon-2e","標題"),k("icon-2e","標題")]),L([g("icon-2e","標題","副標題"),C("icon-2e","標題","副標題"),V("icon-2e","標題","副標題"),k("icon-2e","標題","副標題")]),L([g("icon-2e","標題","副標題",m.value),C("icon-2e","標題","副標題",m.value),V("icon-2e","標題","副標題",m.value),k("icon-2e","標題","副標題",m.value)]),L([g("icon-2e","標題","副標題",null,function(){console.error(this)}),C("icon-2e","標題","副標題",null,function(){console.error(this)}),V("icon-2e","標題","副標題",null,function(){console.error(this)}),k("icon-2e","標題","副標題",null,function(){console.error(this)})])];w(H)});